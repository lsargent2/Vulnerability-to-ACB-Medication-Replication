#Started analysis for TAPH ACB N=80 individuals 
library(ggplot2)
library(car)
#test pearson correlation between ACB scores

#pearson correlation test ACB and ADS total scores
#path: /Volumes/GoogleDrive/My Drive/Research/T.A.P.H/ACB/Dose Calculations/ACB_scales/Final Scores/Combined_Scores.csv
comb1 <- read.csv("Combined_Scores.csv", header = T)
head(comb1)
dim(comb1)
comb1.r <- comb1[c(1:79),c("ACB_Total","ADS_Total","Ave_daily_dose","TSDD","CAB")]
head(comb1.r)

#plot simple satterplot to look at correlation
x <- comb1$ACB_Total
y <- comb1$ADS_Total
color <- c("#999999","#E69F00")
plot(x, y, main = "ACB Measure Correlation", xlab = "ACB total", ylab = "ADS total")
scatterplot(ACB_Total ~ ADS_Total, data = comb1, smoother = F, grid = F, frame = F)

###run pearson corr one at a time in pairs
#evaluate total scores
head(comb1)
comb2 <- cor.test(comb1$TSDD, comb1$CAB,
                    method = "pearson")
comb2


##Exploratory factor analysis 
fit <- princomp(comb1.r, cor=TRUE)
summary(fit)
loadings(fit)
#skree plot 
plot(fit)

##scree plot and parallel 
scree()
vars <- fa.parallel(GT.1[])
# Maximum Likelihood Factor Analysis-used code for each dataset_all-3
# with promax rotation because we expect the latent traits are highly correlated

fit <- factanal(comb1.r, 3, rotation="promax")
fit
print(fit, digits=3, cutoff= 0.5, sort=TRUE)

#Create scores for factors (or consider applying a one factor analysis)
Factor.Scores <- factanal(comb1.r, 2, rotation="promax", scores="regression")

Factor.Scores
Factorscores <- (Factor.Scores$scores)
write.csv(Factorscores, file="factor.scores.csv")
#write loadings
load <- round(unclass(Factor.Scores$loadings), 2)
load

write.csv(load, "GT.all.factors.csv")